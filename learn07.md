## 第7回課題  

### AWSセキュリティ対策について  

* セキュリティで守るものとは何なのか？  
    * 会社の機密情報であったり、顧客の個人情報、クレジットカード情報やコンテンツそのものの情報を守る必要がある。  

* これらの重要な情報はどこにあるのか？  
    * データベース、サーバー、ストレージ、PCや紙など。  

* セキュリティの原則はまず、**想定されるリスクを洗い出す**こと、リスクに対して**対応方針を定義する**こと。  


* 対応方針とは  

|対応|対策|
|---|---|
|受容|そのまま受け入れ、対策は行わない。発生の頻度や影響を鑑みてそのままで良いと判断されたもの|
|低減|影響を減らす対策をする。機密データを１か所に集めるのではなく、分散して個別認証を設定することで、流出の範囲を分割することができる。
|移転（転嫁）|リスク管理を当事者以外に任せる。|
|回避|リスク自体を発生させない。|


 

* セキュリティ対策は誰がするのか？
    * セキュリティ対策の計画主体は事業責任者にあるが、すべてのセキュリティリスクを洗い出すのは不可能。最終判断は事業責任者であるという相手へのインプットや合意を忘れないようにすることが大事。  
    そして、管理している者は誰なのか、アクセス出来るのは誰なのか、全員が責任感を持つことも大事であり、すぐ状態が分かるようにしておくというのも重要。  



* 想定されるリスクの要因  
    * 脆弱性…バグや設定不備による弱点・穴  
    * 認証情報の流出…誤って認証情報をパブリックな場に公開してしまう  
    * 人為的な過負荷…多数のコンピュータから連続でリクエストを送り停止に追いやる。DDoS攻撃など。  

#### 脆弱性の対策  
* アプリケーション、OS、ミドルウェア、ネットワーク、その他への対応を支援するサービスがAWSから提供されている。  

* アプリケーションの脆弱性はアプリケーションコード、機能追加のためのモジュールやライブラリが挙げられる。  
    * ***Dependabot***…GitHubで提供されているモジュール、ライブラリの更新を指摘してくれるBotがあり、自動で検知してPullRequestを作成してくれる。基本的には提案までしかしてくれないが、マージまで自動化させることも可能。  
    * ***Code Guru Reviewer***…Amazon CodeGuruの機能の一つ。AIを使ってGitHubなどのリポジトリにあるJavaやPythonなどのコードをスキャン、改善を提案してくれる。  
    * ***AWS WAF***…ELBまたはCloud Frontに設置することでクライアントのアクセスを必ずWAF(Web Application Firewall)が評価する。AWSが提供するルールグループにはAWS Managed Rules Common RuleSetがあり、OWASP TOP10がサポートされているため、基本的にこのルールグループを利用することを推奨している。  
    * ***SSL接続***…通信経路の暗号化は必須。通信を覗き見されないようにSSL証明書を発行するのがセオリー。  
    * ***ACM***…AWS Certificate Manager。SSL証明書を発行するマネージドサービス。ELBやCloudFrontにアタッチする。パブリック証明書は無料だが、プライベート証明書は有料。パブリック証明書にはドメインが必要で申請者の物である証明が必要。  
    ただし、証明書を発行すればOKではなく、ALBであればHTTPをHTTPSへ転送するルールを追加したり、Cloud FrontであればビューワプロトコルポリシーでHTTPS通信を経由するように設定する必要がある。  

#### OS・ミドルウェアの脆弱性対策  

* ***CVSS***…脆弱性情報をとりまとめる共通脆弱性評価システム。日本のCVSSデータベースはJVN。米国はNIST（National Institute of Standards and Technology「米国国立標準技術研究所」）はNVD。IPA（独立行政法人情報処理推進機構）のセキュリティ情報は確認しておくと良い。  

* ネットワーク通信の許可設定やIAM権限、不要な権限は拒否する「最小限の法則」も脆弱性対策となる。    


     * ***Inspector***…AWSにてOSやミドルウェアの脆弱性検索をしてくれるサービス。EC2とコンテナイメージ向けリポジトリのECRスキャンに対応。情報源は米国のNVD。SSM Patch Managerサービスもあり、パッチ自動化支援を提供。重要度が一番高いものは一ヶ月以内にパッチを適用するなどルール付けの運用が重要。  
    自動修復機能はないが、Event BridgeやSecurity Hubと統合することで脆弱性を解決ための平均時間を短縮することができる。ワークロードを自動的に検出し、組織全体の脆弱性を継続的にスキャンする。  

    * ***Security Hub***…設定情報を検索して脆弱な部分と指摘してくれたり、特定の境界基準に準拠しているかを確認してくれる。有効化から結果が出るまで24時間、結果が出たらDLして無効化すると利用料を抑えられる。他のAWSセキュリティ関連サービス結果を集約できる機能もある。  
    AWS環境全体で自動セキュリティチェックを実行、セキュリティ結果を管理、最優先すべき問題を洗い出す。Event Bridgeと結合して自動応答、修復、強化ワークフローを作成できる。  


#### 認証情報の流出  

 * AWSだけではなくIAMやアプリケーションにおける認証情報もMFAやロール、暗号化を利用して流出を対策しなければならない。
    * ***KMS***…Key Management Service暗号鍵マネージドサービス。暗号鍵を自分で用意しなくて良い。  
    KMS鍵自体がIAMポリシーとキーポリシーと二重で権限管理されてるので鍵の利用権限がないと復号化できない。  
    EBSやS3などの透過的暗号化（何も意識しなくてもデータの読み書き時に自動的に暗号、復号をする仕組み）。AWS CLIなどを用いた鍵の利用。
    Secret Managerと組み合わせることができる。
    * ***Security Manager***…KMSで暗号化して安全に保管・呼び出しができるサービス。シークレット名と設定されているキー（S3と同じ仕組み）を指定するとバリューが返ってくる。バリューの取り出しにはSDKを使って、アプリケーションコードに取り出しの仕組みを実装する。  
    RDSにいてのみDBパスワードの定期変更が可能。DBパスワードは誰も覚えていないが、アプリケーションはちゃんとDBにアクセス可能、という仕組みを確立できる。    


#### 人為的な過負荷  

* 本来想定されるべきではないDDoS攻撃のような負荷をブロックする。  

    * ***Shield***…AWS ShieldはDDoS攻撃からインフラを保護してくれるマネージドサービス。DDoS攻撃と思われる通信を自動遮断。  
    StandardとAdvancedプランがあり、Standardは無料で適用されている。  
    Standardプランでは、Cloud Front、Route53、ElasticIPなどインターネットと接する主要なサービスをサポートしている。  
    Advancedプランでは、Standardプランの内容に加えて、ALBを追加、DDoS攻撃疑いがある情報の通知、専任チームの待機、DDoS攻撃が原因とされるスケール費用を免除、がある。  
    ただし基本的にはStandardで事足りる。Advancedプランはとても高価だが有効化が簡単なためページにもいかない方が得策。

#### そのほか知っておくと良いサービス  

* ***IAM Access Analizer***…各種ポリシーのチェックを行い、大きな権限を与えていないか確認してくれる。S3、IAMロール、KMS、Lambda、SQS、Secret Managerに対応。  
    * 上記と似たものでIAM Access Advisorがある。これはIAMの中の機能でポリシーの利用履歴から最適なポリシーの案を出してくれるもの。
* ***Amazon Gurd Duty***…AWS内のイベントをチェックしてセキュリティインシデントの疑いがあるイベントについて指摘してくれるAI。IAMのアクセス元が複数の国に跨っている（アクセスキー流出の疑い）や、マイニング（仮想通貨の採掘）のネットワークへの通信疑いがある、などを指摘してくれる。  
* ***Marcie***…S3バケットに個人情報やクレジットカード番号など機密情報が含まれていないか検索する。  
* ***Detective***…複数のAWSサービスを横断してセキュリティインシデントの発生元などを特定するためのGUIを提供する。  
* ***Network Firewall***…インターネットゲートウェイとVPCの境界に設置するファイアウォールを実現するサービス。


#### 第7回の講義を終えて  

 * 今回の講義で紹介されたセキュリティサービスは代表的な一部だと思うので、まずは今回のセキュリティサービスが、作った環境に対してどの場所にアタッチして、どうやって守るためのものなのか、もう少し具体的にイメージが出来るようにしていきたいと思いました。  
 * 第5回で作成したアプリケーションは開発環境ですが、本番環境に実装する場合は今回の講義で紹介されたセキュリティサービスの中でも、下記のものを対応させられると環境として安全なのではと考えてみました。  
  また、第6回で設定したCroud TrailやCloud Watchアラームなども併せて証跡もしっかり確認するべきと感じました。  
    * Dependabot（GitHubでチェック）  
    * IAM Access Analizer（ポリシーのチェック）  
    * KMS（暗号鍵）  
    * Secrets Manager（暗号鍵の保管・呼び出し）  
    * Security Hub（設定情報を検索、管理）  
    * Amazon Gurd Duty（AWS内のイベントチェック）  
    * Network Firewall（IGWとVPCのファイアウォール）  
    * AWS WAF（ELBでクライアントのアクセスをチェック）  
    * Inspector（EC2で脆弱性スキャン）  
    * Marcie（S3の機密情報チェック）  

* 引き続き課題を進めながらITパスポートやAWS SAAの資格の学習も併せて知識を深めていきたいと思います。  
